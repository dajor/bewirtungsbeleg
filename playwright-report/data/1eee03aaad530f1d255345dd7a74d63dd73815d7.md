# Test info

- Name: ZUGFeRD PDF Generation >> should generate ZUGFeRD-compliant PDF with all required fields
- Location: /Users/daniel/dev/Bewritung/bewir/test/e2e-zugferd.spec.ts:16:3

# Error details

```
Error: page.fill: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('input[name="datum"]')

    at /Users/daniel/dev/Bewritung/bewir/test/e2e-zugferd.spec.ts:18:16
```

# Page snapshot

```yaml
- img "DocBits Logo"
- heading "Bewirtungsbeleg" [level=1]
- checkbox "Eigenbeleg (ohne Originalbeleg)"
- text: Eigenbeleg (ohne Originalbeleg)
- paragraph: "Aktivieren Sie diese Option, wenn Sie keinen Originalbeleg haben. Hinweis: Bei Eigenbelegen kann die Vorsteuer (MwSt.) nicht geltend gemacht werden."
- heading "Allgemeine Angaben" [level=2]
- paragraph: Foto/Scan der Rechnung
- paragraph: Laden Sie Fotos, Scans oder PDFs hoch - die Daten werden automatisch extrahiert
- button "Choose File"
- img
- paragraph: Dateien hier ablegen
- paragraph: Bilder (PNG, JPEG, WEBP) oder PDFs, max. 5 Dateien
- text: Datum der Bewirtung
- textbox "Datum der Bewirtung"
- text: Restaurant
- textbox "Restaurant"
- button "Restaurant suchen":
  - img
- text: Anschrift
- textbox "Anschrift"
- text: Art der Bewirtung
- paragraph: Wählen Sie die Art der Bewirtung - dies beeinflusst die steuerliche Abzugsfähigkeit
- radiogroup "Art der Bewirtung":
  - radio "Kundenbewirtung (70% abzugsfähig)" [checked]
  - text: Kundenbewirtung (70% abzugsfähig)
  - paragraph: Für Geschäftsfreunde (Kunden, Geschäftspartner). 70% der Kosten sind als Betriebsausgabe abziehbar.
  - radio "Mitarbeiterbewirtung (100% abzugsfähig)"
  - text: Mitarbeiterbewirtung (100% abzugsfähig)
  - paragraph: Für betriebliche Veranstaltungen (Teamessen, Arbeitsessen). 100% der Kosten sind als Betriebsausgabe abziehbar.
- heading "Finanzielle Details" [level=2]
- checkbox "Ausländische Rechnung (keine MwSt.)"
- text: Ausländische Rechnung (keine MwSt.)
- paragraph: Aktivieren Sie diese Option, wenn die Rechnung aus dem Ausland stammt. In diesem Fall wird der Gesamtbetrag als Netto behandelt.
- separator
- checkbox "ZUGFeRD-kompatibles PDF generieren"
- text: ZUGFeRD-kompatibles PDF generieren
- paragraph: Erstellt ein elektronisches Rechnungsformat nach ZUGFeRD 2.0 Standard für die digitale Archivierung
- text: Gesamtbetrag (Brutto)
- paragraph: Geben Sie den Gesamtbetrag der Rechnung ein (inkl. MwSt.)
- textbox "Gesamtbetrag (Brutto)"
- text: MwSt. Gesamtbetrag
- paragraph: MwSt. (19%) wird automatisch berechnet
- textbox "MwSt. Gesamtbetrag"
- text: Netto Gesamtbetrag
- paragraph: Netto wird automatisch berechnet
- textbox "Netto Gesamtbetrag"
- text: Betrag auf Kreditkarte/Bar
- paragraph: Geben Sie den Betrag ein, der auf der Kreditkarte belastet wurde (inkl. Trinkgeld)
- textbox "Betrag auf Kreditkarte/Bar"
- text: Trinkgeld
- paragraph: Geben Sie das Trinkgeld ein. Dies wird automatisch berechnet, wenn Sie den Betrag auf der Kreditkarte eingeben
- textbox "Trinkgeld"
- text: MwSt. Trinkgeld
- paragraph: MwSt. (19%) wird automatisch berechnet
- textbox "MwSt. Trinkgeld"
- text: Zahlungsart
- paragraph: Wählen Sie die Art der Zahlung. Die Rechnung muss auf die Firma ausgestellt sein.
- textbox "Zahlungsart": Firmenkreditkarte
- img
- heading "Geschäftlicher Anlass" [level=2]
- text: Geschäftlicher Anlass
- paragraph: Geben Sie den konkreten Anlass an (z.B. 'Kundengespräch', 'Projektbesprechung')
- textbox "Geschäftlicher Anlass"
- text: Namen aller Teilnehmer
- paragraph: Geben Sie die Namen aller Teilnehmer ein (auch Ihren eigenen Namen)
- textbox "Namen aller Teilnehmer"
- text: Namen der Geschäftspartner
- paragraph: Geben Sie die Namen der Geschäftspartner ein
- textbox "Namen der Geschäftspartner"
- text: Firma der Geschäftspartner
- paragraph: Geben Sie die Firma der Geschäftspartner ein
- textbox "Firma der Geschäftspartner"
- button "JSON Download":
  - img
  - text: JSON Download
- img
- button "JSON Upload"
- button "Bewirtungsbeleg erstellen"
- alert
```

# Test source

```ts
   1 | /**
   2 |  * E2E Tests for ZUGFeRD PDF Generation
   3 |  * Tests the complete workflow of generating ZUGFeRD-compliant PDFs
   4 |  */
   5 |
   6 | import { test, expect } from '@playwright/test';
   7 | import path from 'path';
   8 | import fs from 'fs';
   9 |
   10 | test.describe('ZUGFeRD PDF Generation', () => {
   11 |   test.beforeEach(async ({ page }) => {
   12 |     await page.goto('/bewirtungsbeleg');
   13 |     await page.waitForLoadState('networkidle');
   14 |   });
   15 |
   16 |   test('should generate ZUGFeRD-compliant PDF with all required fields', async ({ page }) => {
   17 |     // Fill in the form with complete data
>  18 |     await page.fill('input[name="datum"]', '15.04.2024');
      |                ^ Error: page.fill: Test timeout of 30000ms exceeded.
   19 |     await page.fill('input[name="restaurantName"]', 'Restaurant Zur Post');
   20 |     await page.fill('input[name="restaurantAnschrift"]', 'Hauptstraße 42');
   21 |     await page.fill('input[name="restaurantPlz"]', '10115');
   22 |     await page.fill('input[name="restaurantOrt"]', 'Berlin');
   23 |     
   24 |     // Company details
   25 |     await page.fill('input[name="unternehmen"]', 'DocBits GmbH');
   26 |     await page.fill('input[name="unternehmenAnschrift"]', 'Technologiepark 10');
   27 |     await page.fill('input[name="unternehmenPlz"]', '20099');
   28 |     await page.fill('input[name="unternehmenOrt"]', 'Hamburg');
   29 |     
   30 |     // Participants and occasion
   31 |     await page.fill('textarea[name="teilnehmer"]', 'Max Mustermann, Erika Musterfrau');
   32 |     await page.fill('textarea[name="anlass"]', 'Geschäftsbesprechung Q2 Planung');
   33 |     
   34 |     // Amounts with German decimal format
   35 |     await page.fill('input[name="speisen"]', '45,00');
   36 |     await page.fill('input[name="getraenke"]', '30,00');
   37 |     await page.fill('input[name="trinkgeld"]', '5,00');
   38 |     await page.fill('input[name="gesamtbetrag"]', '80,00');
   39 |     
   40 |     // Select payment and entertainment type
   41 |     await page.selectOption('select[name="zahlungsart"]', 'firma');
   42 |     await page.selectOption('select[name="bewirtungsart"]', 'kunden');
   43 |     
   44 |     // Business partner details for customer entertainment
   45 |     await page.fill('input[name="geschaeftspartnerNamen"]', 'Max Mustermann, Erika Musterfrau');
   46 |     await page.fill('input[name="geschaeftspartnerFirma"]', 'Example AG');
   47 |     
   48 |     // Enable ZUGFeRD generation
   49 |     const zugferdCheckbox = page.locator('input[name="generateZugferd"]');
   50 |     if (await zugferdCheckbox.isVisible()) {
   51 |       await zugferdCheckbox.check();
   52 |     }
   53 |     
   54 |     // Upload a test receipt image
   55 |     const testImagePath = path.join(process.cwd(), 'test', 'test-receipt.png');
   56 |     if (!fs.existsSync(testImagePath)) {
   57 |       // Create a simple test image if it doesn't exist
   58 |       const pngBuffer = Buffer.from([
   59 |         0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
   60 |         0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
   61 |         0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
   62 |         0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53,
   63 |         0xDE, 0x00, 0x00, 0x00, 0x0C, 0x49, 0x44, 0x41,
   64 |         0x54, 0x08, 0x99, 0x63, 0xF8, 0xCF, 0xC0, 0x00,
   65 |         0x00, 0x00, 0x03, 0x00, 0x01, 0x5E, 0xF9, 0x51,
   66 |         0x36, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E,
   67 |         0x44, 0xAE, 0x42, 0x60, 0x82
   68 |       ]);
   69 |       fs.writeFileSync(testImagePath, pngBuffer);
   70 |     }
   71 |     
   72 |     const fileInput = page.locator('input[type="file"][accept*="image"], input[type="file"][accept*="pdf"]').first();
   73 |     await fileInput.setInputFiles(testImagePath);
   74 |     await page.waitForTimeout(1000);
   75 |     
   76 |     // Set up response listener for PDF generation
   77 |     const downloadPromise = page.waitForEvent('download');
   78 |     
   79 |     // Click generate PDF button
   80 |     const generateButton = page.locator('button:has-text("PDF generieren")');
   81 |     await generateButton.click();
   82 |     
   83 |     // Wait for the download
   84 |     const download = await downloadPromise;
   85 |     
   86 |     // Verify the download
   87 |     expect(download).toBeTruthy();
   88 |     const fileName = download.suggestedFilename();
   89 |     expect(fileName).toContain('zugferd');
   90 |     expect(fileName).toEndWith('.pdf');
   91 |     
   92 |     // Save the file for inspection
   93 |     const downloadPath = path.join(process.cwd(), 'test-results', fileName);
   94 |     await download.saveAs(downloadPath);
   95 |     
   96 |     // Verify file exists and has content
   97 |     const fileStats = fs.statSync(downloadPath);
   98 |     expect(fileStats.size).toBeGreaterThan(1000); // PDF should be at least 1KB
   99 |     
  100 |     console.log(`ZUGFeRD PDF generated: ${downloadPath} (${fileStats.size} bytes)`);
  101 |   });
  102 |
  103 |   test('should handle ZUGFeRD generation errors gracefully', async ({ page }) => {
  104 |     // Fill minimal required fields
  105 |     await page.fill('input[name="datum"]', '15.04.2024');
  106 |     await page.fill('input[name="restaurantName"]', 'Test Restaurant');
  107 |     await page.fill('textarea[name="teilnehmer"]', 'Test Person');
  108 |     await page.fill('textarea[name="anlass"]', 'Test');
  109 |     await page.fill('input[name="gesamtbetrag"]', '50,00');
  110 |     
  111 |     // Enable ZUGFeRD with incomplete data
  112 |     const zugferdCheckbox = page.locator('input[name="generateZugferd"]');
  113 |     if (await zugferdCheckbox.isVisible()) {
  114 |       await zugferdCheckbox.check();
  115 |     }
  116 |     
  117 |     // Mock the ZUGFeRD API to return an error
  118 |     await page.route('**/api/zugferd/**', route => {
```