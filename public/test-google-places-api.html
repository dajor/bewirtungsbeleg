<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .error {
            background: #fee;
            border-color: #c00;
            color: #c00;
        }
        .success {
            background: #efe;
            border-color: #0c0;
            color: #0a0;
        }
        input {
            padding: 10px;
            width: 100%;
            font-size: 16px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Google Places API Tester</h1>

    <div>
        <label for="apiKey">API Key:</label>
        <input type="text" id="apiKey" placeholder="Paste your Google Places API key here" value="AIzaSyBSqixUa3E5flEp0onoLHllCuglAiJMU6U">
    </div>

    <div>
        <label for="searchQuery">Search Query:</label>
        <input type="text" id="searchQuery" placeholder="Enter search query (e.g., FELLOWPRO POING)" value="FELLOWPRO POING">
    </div>

    <button onclick="testAPI()">Test API</button>
    <button onclick="testKnownPlace()" style="background: #28a745; margin-left: 10px;">Test with Known Place (McDonald's M√ºnchen)</button>

    <div id="results"></div>

    <script>
        let service = null;

        function loadGoogleMapsScript(apiKey) {
            return new Promise((resolve, reject) => {
                if (window.google?.maps?.places) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&language=de`;
                script.async = true;
                script.defer = true;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Failed to load Google Maps script'));
                document.head.appendChild(script);
            });
        }

        async function testAPI() {
            const apiKey = document.getElementById('apiKey').value;
            const searchQuery = document.getElementById('searchQuery').value;
            const resultsDiv = document.getElementById('results');

            resultsDiv.innerHTML = '<div class="result">Loading Google Maps API...</div>';

            try {
                // Check for API errors in console
                const originalConsoleError = console.error;
                const apiErrors = [];
                console.error = function(...args) {
                    const message = args.join(' ');
                    if (message.includes('ApiNotActivatedMapError') || message.includes('API')) {
                        apiErrors.push(message);
                    }
                    originalConsoleError.apply(console, args);
                };

                // Load Google Maps API
                await loadGoogleMapsScript(apiKey);

                // Wait a bit to see if API errors appear
                await new Promise(resolve => setTimeout(resolve, 1000));

                if (apiErrors.length > 0) {
                    resultsDiv.innerHTML = '<div class="result error"><strong>‚ùå API Configuration Error</strong><br>' +
                        '<p>The Google Maps JavaScript API is not enabled in your Google Cloud project.</p>' +
                        '<p><strong>Fix:</strong></p>' +
                        '<ol>' +
                        '<li>Go to <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>' +
                        '<li>Select your project</li>' +
                        '<li>Go to "APIs & Services" ‚Üí "Library"</li>' +
                        '<li>Search for "Maps JavaScript API"</li>' +
                        '<li>Click "Enable"</li>' +
                        '</ol>' +
                        '<details><summary>Error details</summary><pre>' + apiErrors.join('\n') + '</pre></details>' +
                        '</div>';
                    console.error = originalConsoleError;
                    return;
                }

                console.error = originalConsoleError;
                resultsDiv.innerHTML = '<div class="result success">‚úì Google Maps API loaded successfully</div>';

                // Create service
                if (!service) {
                    const div = document.createElement('div');
                    service = new google.maps.places.PlacesService(div);
                }

                resultsDiv.innerHTML += '<div class="result">Searching for: ' + searchQuery + '</div>';

                // Perform search
                const request = {
                    query: searchQuery,
                    language: 'de',
                    region: 'de',
                };

                console.log('üîç Search request:', request);

                // Add timeout to detect if API never responds
                let responded = false;
                setTimeout(() => {
                    if (!responded) {
                        resultsDiv.innerHTML += '<div class="result error">‚ö†Ô∏è API is taking too long to respond (>10s). Check console for errors.</div>';
                    }
                }, 10000);

                service.textSearch(request, (results, status) => {
                    responded = true;
                    console.log('üìç Search response:', { status, resultsCount: results?.length, results });

                    if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                        let html = '<div class="result success"><strong>‚úì Found ' + results.length + ' results</strong></div>';

                        results.forEach((place, index) => {
                            html += '<div class="result">';
                            html += '<h3>' + (index + 1) + '. ' + place.name + '</h3>';
                            html += '<p><strong>Address:</strong> ' + place.formatted_address + '</p>';
                            if (place.rating) {
                                html += '<p><strong>Rating:</strong> ' + place.rating + ' (' + (place.user_ratings_total || 0) + ' reviews)</p>';
                            }
                            html += '<p><strong>Place ID:</strong> ' + place.place_id + '</p>';
                            html += '<details><summary>Full JSON</summary><pre>' + JSON.stringify(place, null, 2) + '</pre></details>';
                            html += '</div>';
                        });

                        resultsDiv.innerHTML = html;
                    } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                        resultsDiv.innerHTML = '<div class="result error">No results found for "' + searchQuery + '"</div>';
                    } else if (status === google.maps.places.PlacesServiceStatus.REQUEST_DENIED) {
                        resultsDiv.innerHTML = '<div class="result error"><strong>REQUEST_DENIED</strong><br>Your API key may have restrictions. Check:<ul><li>API key restrictions in Google Cloud Console</li><li>HTTP referrer restrictions</li><li>API is enabled</li><li>Billing is enabled</li></ul></div>';
                    } else if (status === google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT) {
                        resultsDiv.innerHTML = '<div class="result error"><strong>OVER_QUERY_LIMIT</strong><br>API quota exceeded. Check your usage limits in Google Cloud Console.</div>';
                    } else {
                        resultsDiv.innerHTML = '<div class="result error"><strong>Error:</strong> ' + status + '</div>';
                    }
                });

            } catch (err) {
                console.error('Error:', err);
                resultsDiv.innerHTML = '<div class="result error"><strong>Error loading Google Maps:</strong> ' + err.message + '</div>';
            }
        }

        function testKnownPlace() {
            document.getElementById('searchQuery').value = 'McDonald\'s M√ºnchen';
            testAPI();
        }

        // Auto-test on page load
        window.addEventListener('load', () => {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey && apiKey !== 'YOUR_API_KEY_HERE') {
                setTimeout(testAPI, 1000);
            }
        });
    </script>
</body>
</html>
